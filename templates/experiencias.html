<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro de Experiencias</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h1>Registrar Experiencia</h1>
        <form id="frmexperiencias">
            <div class="form-group">
                <label for="txtNombreApellido">Nombre y Apellido:</label>
                <input type="text" class="form-control" id="txtNombreApellido" name="txtNombreApellido" required>
            </div>
            <div class="form-group">
                <label for="txtComentario">Comentario:</label>
                <textarea class="form-control" id="txtComentario" name="txtComentario" required></textarea>
            </div>
            <div class="form-group">
                <label for="txtCalificacion">Calificación:</label>
                <input type="number" class="form-control" id="txtCalificacion" name="txtCalificacion" required>
            </div>
            <button type="submit" class="btn btn-primary">Registrar</button>
        </form>

        <h2>Experiencias Registradas</h2>
        <div id="experienciasList"></div>
    </div>

    <script>
        // Validación del formulario
        $("#frmexperiencias").validate({
            messages: {
                txtNombreApellido: {
                    required: "Ingresa tu Nombre y Apellido",
                    minlength: "Ingresa al menos 8 letras",
                    maxlength: "Ingresa menos de 25 letras"
                },
                txtComentario: {
                    required: "Ingresa una reseña positiva",
                    minlength: "Ingresa más de 6 caracteres",
                    maxlength: "Ingresa menos de 250 caracteres" // Ajuste aquí
                },
                txtCalificacion: {
                    required: "Ingresa una calificación",
                    digits: "La calificación es de solo números"
                }
            },
            rules: {
                txtNombreApellido: {
                    required: true,
                    minlength: 8,
                    maxlength: 25
                },
                txtComentario: {
                    required: true,
                    minlength: 6,
                    maxlength: 250
                },
                txtCalificacion: {
                    required: true,
                    digits: true
                }
            },
            submitHandler: function(form) {
                // Enviar datos al servidor
                $.ajax({
                    url: '/registrar',
                    method: 'POST',
                    data: $(form).serialize(),
                    success: function(response) {
                        alert(response.message);
                        // Aquí puedes agregar lógica para actualizar la lista de experiencias
                    }
                });
            }
        });

        // Funciones para eliminar y editar
        function eliminarExperiencia(id) {
            fetch(`/experiencia/eliminar/${id}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    // Actualiza la URL
                    window.history.pushState({}, '', `https://practica2-k09g.onrender.com?eliminar/id=${id}`);
                    // Lógica para eliminar el elemento de la UI
                }
            });
        }

        function editarExperiencia(id) {
            const nombreApellido = prompt("Ingrese nuevo nombre y apellido:");
            const comentario = prompt("Ingrese nuevo comentario:");
            const calificacion = prompt("Ingrese nueva calificación:");

            fetch(`/experiencia/actualizar/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nombre_apellido: nombreApellido, comentario: comentario, calificacion: calificacion })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    // Actualiza la URL
                    window.history.pushState({}, '', `https://practica2-k09g.onrender.com?editar/id=${id}`);
                    // Lógica para actualizar el elemento en la UI
                }
            });
        }

        // Aquí puedes agregar una función para cargar experiencias
        function cargarExperiencias() {
            fetch('/buscar')
                .then(response => response.json())
                .then(data => {
                    // Lógica para mostrar experiencias en el div experienciasList
                });
        }

        $(document).ready(function() {
            cargarExperiencias();
        });
    </script>
</body>
</html>
